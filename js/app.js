const btnsTabMenu=document.querySelectorAll(".tab-menu__btn"),tabMenuPanel=document.querySelectorAll(".tab-menu__panel"),a=document.querySelectorAll("a"),search=document.getElementById("search"),btnSearch=document.getElementById("btn-search");class APIQuery{constructor(){}getQueryData=async e=>{const t=await fetch(e);if(!t.ok)throw new Error(`Ошибка по адресу ${e}, стутус ошибки ${t}`);return await t.json()};sendData=async(e,t)=>{const a=await fetch(e,t);if(!a.ok)throw new Error(`Ошибка по адресу ${e}, стутус ошибки ${a}`);return await a.json()}}class TabMenu{#e;#t;constructor(e,t){this.#e=e,this.#t=t}ActiveContentTabMenu=e=>{e.classList.contains("btn-active")||(e===this.#e[0]?(this.#e[0].classList.add("btn-active"),this.#e[1].classList.remove("btn-active"),this.#t[0].style.display="block",this.#t[1].style.display="none"):(this.#e[0].classList.remove("btn-active"),this.#e[1].classList.add("btn-active"),this.#t[0].style.display="none",this.#t[1].style.display="block"))}}class Weather{#a;#n;static city;constructor(){this.#a=new APIQuery,this.#n=new DateTimeWork}get(e){const t="c04f46f774de2f467fa5443d7c7f9950",a=`https://api.openweathermap.org/data/2.5/weather?q=${e}&units=metric&lang=en&appid=${t}`,n=`https://api.openweathermap.org/data/2.5/forecast?q=${e}&lang=en&units=metric&cnt=8&appid=${t}`,r=`https://api.openweathermap.org/data/2.5/forecast?q=${e}&lang=en&units=metric&cnt=40&appid=${t}`;this.#a.getQueryData(a).then((e=>{this.getCurrentForecast(e)})).catch((e=>{console.error(e),alert(e)})),this.#a.getQueryData(n).then((e=>{this.getHourlyForecast(e)})).catch((e=>{console.error(e),alert(e)})),this.#a.getQueryData(r).then((e=>{this.getForecastOnSevenDay(e)})).catch((e=>{console.error(e),alert(e)}))}getCurrentForecast(e){const t=document.getElementById("current-data"),a=document.getElementById("city"),n=document.querySelector(".tab-menu__img"),r=document.querySelector(".tab-menu__subtext"),s=document.querySelector(".tab-menu__heading"),o=document.querySelector(".tab-menu__real-feel"),i=document.querySelector(".tab-menu__sunrise"),c=document.querySelector(".tab-menu__sunset"),u=document.querySelector(".tab-menu__duration"),l=this.#n.getTime(1e3*e.sys.sunrise,!1),h=this.#n.getTime(1e3*e.sys.sunset,!1),d=this.#n.getDurationTime(1e3*e.sys.sunrise,1e3*e.sys.sunset,!1);return m=this.#n,t.textContent=m.getDate(1e3*e.dt),a.innerHTML=`<span class="tab-menu__hourly--city-name title">City: </span>${e.name}`,n.src=`https://openweathermap.org/img/wn/${e.weather[0].icon}.png`,r.textContent=e.weather[0].description,s.textContent=`${Math.round(e.main.temp)}°C`,o.innerHTML=`<span>Real Feel: </span>${Math.round(e.main.feels_like)}°C`,i.innerHTML=`<span class="tab-menu__text">Sunrise: </span>${l}`,c.innerHTML=`<span class="tab-menu__text">Sunset: </span>${h}`,void(u.innerHTML=`<span class="tab-menu__text">Duration: </span>${d}`);var m}getHourlyForecast(e){const t=document.querySelectorAll(".tab-menu__hourly--list");for(let a=0;a<e.list.length;a++){const n=e.list[a];if(a<=5){const e=new Date(n.dt_txt),a=document.createElement("li");a.classList.add("tab-menu__hourly--item"),a.innerHTML=`<p class="tab-menu__hourly--time">${this.#n.getTime(e,!1)}</p>\n                                <img class="tab-menu__hourly--icon" src="https://openweathermap.org/img/wn/${n.weather[0].icon}.png" alt="img-icon-forecast"/>\n                                <p class="tab-menu__hourly--forecast">${n.weather[0].description}</p>\n                                <p class="tab-menu__hourly--temp">${Math.round(n.main.temp)}&deg;</p>\n                                <p class="tab-menu__hourly--real-feel">${Math.round(n.main.feels_like)}&deg;</p>\n                                <p class="tab-menu__hourly--wind">${Math.round(n.wind.speed)} ${this.getWindFormat(n.wind.deg)}</p>\n                                `,t.forEach((e=>{e.append(a.cloneNode(!0))}))}}}getForecastOnSevenDay(e){const t=document.querySelector(".tab-menu__weather-days--list"),a=this.filterDay(e);for(let e in a){const n=document.createElement("li");n.classList.add("tab-menu__weather-days--item");const r=this.#n.getWeekDayName(e),s=new Date(e).toLocaleString("default",{month:"long"}),o=new Date(e).getDate(),i=`https://openweathermap.org/img/wn/${a[e][0].weather[0].icon}.png`,c=Math.round(a[e][0].main.temp),u=a[e][0].weather[0].description.replace(" ","<br>");n.innerHTML=`<a href="#" class="tab-menu__weather-days--link">\n                                <h2 class="tab-menu__weather-days--title title">${r}</h2>\n                                <p class="tab-menu__weather-days--data">\n                                    <span class="tab-menu__weather-days--year">${s}</span>\n                                    <span class="tab-menu__weather-days--day">${o}</span>\n                                </p>\n                                <img class="tab-menu__weather-days--img" src="${i}" alt="icon-forecast">\n                                <p class="tab-menu__weather-days--temp">${c}&deg;C</p>\n                                <p class="tab-menu__weather-days--forecast">${u}</p>\n                            </a>\n                            `,t.append(n)}}getWindFormat(e){switch(!0){case e>=0&&e<45:return"N";case e>=45&&e<90:return"NE";case e>=90&&e<135:return"E";case e>=135&&e<180:return"SE";case e>=180&&e<225:return"S";case e>=225&&e<270:return"SW";case e>=270&&e<315:return"W";case e>=315&&e<360:return"NW";default:return"N"}}refreshWeather(){const e=document.querySelectorAll(".tab-menu__hourly--list"),t=document.querySelector(".tab-menu__weather-days--list");e.forEach((e=>{e.innerHTML=""})),t.innerHTML=""}filterDay(e){const t={};return e.list.forEach((e=>{const a=e.dt_txt.split(" ")[0];t[a]?t[a].push(e):t[a]=[e]})),t}}class DateTimeWork{days=["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"];getDate(e=0){let t=0===e?new Date:new Date(e);const a=t.getMonth()+1>9?`${t.getMonth()+1}`:`0${t.getMonth()+1}`;return`${t.getDate()}.${a}.${t.getFullYear()}`}getTime(e=0,t=!0){let a=0===e?new Date:new Date(e);const n=this.#r(a.getHours()),r=this.#r(a.getMinutes()),s=this.#r(a.getSeconds());return!0===t?`${n}:${r}:${s}`:`${n}:${r}`}getDurationTime(e,t,a=!0){const n=t-e,r=Math.floor(n/36e5),s=Math.floor(n%36e5/6e4),o=Math.floor(n%6e4/1e3);return!0===a?`${r}:${s}:${o}`:`${r}:${s}`}getWeekDayName(e){return this.getDate(e)===this.getDate()?"ToNight":this.days[new Date(e).getDay()]}#r(e){return e>9?`${e}`:`0${e}`}}const tabMenu=new TabMenu(btnsTabMenu,tabMenuPanel),weather=new Weather;window.addEventListener("load",(e=>{btnsTabMenu[0].classList.add("btn-active"),tabMenuPanel[1].style.display="none",weather.get("Kyiv")})),btnsTabMenu.forEach((e=>{e.addEventListener("click",(t=>{tabMenu.ActiveContentTabMenu(e)}))})),a.forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault()}))})),btnSearch.addEventListener("click",(e=>{Weather.city=search.value,weather.refreshWeather(),weather.get(Weather.city)}));